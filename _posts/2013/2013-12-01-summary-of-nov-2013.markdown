---
layout: post
title: 2013年11月
date: 2013-12-01 19:04:55
categories:
- 活着/still alive
tags:
- 月记
---

今天是2013年最後一個月的第一天，週末，晴。來回顧一下這個不要太精彩的十一月。

剛才檢查iPhoto照片流，發現這個月沒有照什麼照片，足以說明我有多忙。十一月的主線應該都和工作有關。工作，工作，還是工作。

**[雙十一]**

今年的雙十一算是成功落幕了。350億的銷售額又可以自豪一年了。這個數字的背後其實還少算了預售的10+億，所以其實今年的真實數字是360-370億。由於預售訂單結算的流程出了Bug，沒有被計入總成交額。

系統整體算非常穩定，與去年比起來，由於今年做了更多的系統優化(詳情頁面與購物車上CDN，能支撐十萬級別的QPS，以及交易系統可以支持峯值每秒6萬訂單)以及整個交易鏈路做了5次全鏈路壓測(這個真的很牛逼，未來可能會產品化面向外部企業提供方案)。我自己在11號零點時的下單就比去年順暢許多，甚至搶到了非常難搶的Uniqlo的4件衣服(Uniqlo實體店的店員都誇我牛逼哈哈哈)。這次雙十一我的消費額是1000RMB左右，還是沒有搶到大紅包的情況，除了上面說的Uniqlo衣服，還有就是買了一雙Air Jordan Ace 23。我穿了6年的安踏球鞋終於退役了，高二穿到現在真是不說啥了。但是由於工作實在忙的變汪了，到現在都沒有穿新球鞋打過球，爭取下週打一下。

**[狂歡前夜驚魂]**

扯遠了，回到驚心動魄的重點：在一片祥和之下，由於我的原因，差點捅出一個驚天大Bug，可能造成的影響就是，在0點時，用IE6以及IE7內核瀏覽器的用戶無法在詳情頁下單，佔比大概是所有流量的7%，估值損失大概是1億RMB...

這件事情，現在想起來我自己都還是會害怕。但是由於「運氣就是我實力的全部」，在一系列曲折離奇的意外後，這個Bug在雙十一開始前的7小時提前暴露出來，我們在十分鐘之內修復了這個問題。

具體過程如下，拋去各種術語，還是萬分精彩的電影劇情：

1. 雙十一的前一週，發現由於頁面緩存，在商品sku庫存售罄後，頁面sku依然能夠被選中，發現Bug後弓爺果斷修復，成果就是無論頁面被緩存多久，sku與庫存相關的展現都能做到實時更新，爲後續突發情況需緩存12小時奠定了基礎。

2. 雙十一的前一天，發現CDN網絡應用的緩存磁盤，SAMSUNG SSD出現寫入過慢，速度僅有幾十MB，與普通硬盤無區別，甚至更低。寫入過慢的問題會在雙十一零點爆發出雪崩效應(需寫入緩存的商品量級越大，寫入越來不及，最終會導致IO奔潰甚至當機)，緊急方案是頁面緩存12小時，預熱1000萬商品來提高峯值時的命中率，並視情況選擇關閉寫入。

3. 雙十一前的8個小時，開啓弱依賴數據，發佈頁面模板。因爲頁面緩存12小時，也就是12小時內頁面靜態內容不更新，異步優惠以及庫存信息是不受影響的。但是如果異步請求挂了，頁面也會讀不到任何優惠。所以我做了一個頁面弱依賴數據，如果異步請求挂了，前端JS代碼會讀存在頁面裏的JSON數據。這個弱依賴本來只會在雙十一當天打開，但是由於這個情況，去掉了時間判斷，提前了8小時數據存入頁面。

4. 開啓弱依賴數據半小時後，前端監控頁面告警，IE6以及IE7內核的瀏覽器大量報錯，經排查，是弱依賴區塊的JSON數據格式錯誤，多了2個逗號，導致影響JS讀取整個頁面的數據失敗。

5. 迅速修正Bug，再次發佈。發現到解決耗時10分鐘。後續無其他問題，驚險解決。

回顧上面的整個過程，環環緊扣，如果不是sku庫存Bug提前修復，我們是不敢切換成12小時緩存的。如果不是CDN的SSD出現問題，我們也是不會切成12小時緩存並且無奈之下先放出弱依賴的大促優惠信息的。如果不是我將判斷時間邏輯寫在頁面上，也是不會提前8小時發佈的，也就不可避免這個BUG了。如果發佈完不是前端有完善的監控系統，我們可能也不會馬上發現頁面報錯的。總而言之，運氣就是我實力的全部。

這個傳奇的意外給我上了一課，我一遍感謝着這個世界對我表達的深深善意，一遍檢討着自己又一次因爲馬虎而差點造成的悲劇。僅僅因爲兩個多餘的逗號，差點將一個完美的歷史之夜毀滅。

I.細節決定成敗。

II.一定要做到最完美，能絕對依靠的只有你自己。

然後，我也覺得我真夠牛逼了，以一己之力差點在電子商務以及互聯網歷史上寫下濃重的一筆，好險，我操。

![](http://farm6.staticflickr.com/5504/11149466195_f1b27c84e2_b.jpg)

**[擁抱變化]**

雙十一之前就已經知曉，集團將對商城進行大的人員調整。包括技術，運營，產品在內的各路大佬將會輪崗轉職到其他的子公司以及業務線去。我原來以爲這些對於我來說是沒啥關係的，畢竟我只是一個小兵，做好自己的工作就好了(特別是寫好代碼不要多出不該多的東西比如兩個逗號！=。=)

雙十一還差3小時結束時，交易額過300億，園區開始放煙火慶祝，我看着煙火無線感慨了很久。想着今夜如此的輝煌，明天卻又是一個新的開始，小伙子好好幹之類的自己都很感動的想法。

然後才過了三天，就被主管拉走聊了天，問我要不要去做無線SNS，嘗試一下新的領域。我整個人就震驚了。因爲之前是主管的主管，也就是我們部門的老大要去帶無線SNS的技術研發團隊的。沒想到還要帶人過去。我本着有啥吃啥給啥吃啥的心態，就假裝很隨意的回答說可以啊，其實內心還是挺忐忑的，畢竟人都願意待在已經習慣而且舒服的位置。

然後我就離開了大商城，奔向了無線大ALL IN的洪流之中。

從2012年7月11日開始實習，到這次無線ALL IN，我待了838天。經歷了很多，成長了也很多。當然我也知道天下沒有不散的宴席，而且只是換了個樓和部門又不是什麼離別，但是還是蠻有感觸的，還有不捨。

但是從打京東變成打騰訊，從爭奪Web到爭奪Mobile，還是蠻有意思的。盡力而爲。

![](http://farm6.staticflickr.com/5496/11149465905_8e25bec5e8_b.jpg)

**[晉升]**

終於小升了一下，不多表。

**[其他]**

這個月除了在加班還真的沒有做了其他什麼事情。月初搞了把Fusion Drive，mbp很好用，除了沒有Retina屏幕。

每週有去一次電影院，這篇寫完我打算再去看一場電影。

讀書少容易被人騙的，所以打算開始多讀書，少把時間花在看美劇上。


最後放一張天貓詳情團隊的全家福。謝謝你們，謝謝了。

![](http://farm8.staticflickr.com/7345/11149465055_833fc94356_b.jpg)



